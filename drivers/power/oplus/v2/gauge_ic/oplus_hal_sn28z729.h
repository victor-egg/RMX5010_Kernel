/* SPDX-License-Identifier: GPL-2.0-only  */
/*
* Copyright (C) 2018-2025 Oplus. All rights reserved.
*/

#ifndef __OPLUS_SN28Z729_H__
#define __OPLUS_SN28Z729_H__

#define SN28Z729_I2C_ADDR				0x55
#define SN28Z729_DATA_FLASH_BLOCK		0x3e
#define SN28Z729_BLOCK_SIZE				32

#define SN28Z729_REG_DEVICE_TYPE		0x0001
#define SN28Z729_DEVICE_TYPE_NUM_SIZE	2

#define SN28Z729_REG_STATIC_DF_SIG		0x0005
#define SN28Z729_REG_CHEMID				0x0006
#define SN28Z729_REG_STATIC_CHEM_DF_SIG		0x0008

#define SN28Z729_REG_MANUFACTURER_NAME		0x004c
#define SN28Z729_BATT_SERIAL_NUM_SIZE		19

#define SN28Z729_REG_OPERATION_STATUS		0x0054
#define SN28Z729_SEAL_NUM_SIZE				2
#define SN28Z729_SEAL_MASK_BIT				(BIT(0) | BIT(1))

#define SN28Z729_REG_GAUGEING_STATUS		0x0056

#define SN28Z729_REG_TERM_VOLT			0x0059
#define SN28Z729_TERM_VOLT_BLOCK_SIZE	5
#define SN28Z729_TERM_VOLT_NUM_SIZE		5
#define SN28Z729_TERM_VOLT_OFFSET		0
#define SN28Z729_TERM_VOLT_HOLD_TIME	10

#define SN28Z729_REG_LIFETIME_ADDR		0x0060
#define SN28Z729_LIFETIME_NUM_SIZE		10

#define SN28Z729_REG_QMAX_UPDATE_CONDTION	0x0062
#define SN28Z729_REG_IPM_1_ADDR				0x0065
#define SN28Z729_REG_IPM_2_ADDR				0x0066

#define SN28Z729_REG_DA_STATUS1			0x0071
#define SN28Z729_VOLT_NUM_SIZE			4

#define SN28Z729_REG_IT_STATUS1			0x0073

#define SN28Z729_REG_IT_STATUS2			0x0074
#define SN28Z729_DOD_NUM_SIZE			6
#define SN28Z729_DOD_OFFSET				10

#define SN28Z729_REG_IT_STATUS3			0x0075
#define SN28Z729_QMAX_NUM_SIZE			10

#define SN28Z729_REG_CB_STATUS			0x0076

#define SN28Z729_REG_HMAC_CTRL			0x00
#define SN28Z729_REG_HMAC_DATA			0X40
#define SN28Z729_REG_HMAC_CHECKSUM		0X54

#define SN28Z729_REG_OPLUS_DATA			0x00B1
#define SN28Z729_DEEP_COUNT_NUM_SIZE	2
#define SN28Z729_DEEP_COUNT_OFFSET		0
#define SN28Z729_DEEP_VOLT_NUM_SIZE		2
#define SN28Z729_DEEP_VOLT_OFFSET		3
#define SN28Z729_DEEP_LAST_CC_NUM_SIZE	2
#define SN28Z729_DEEP_LAST_CC_OFFSET	6
#define SN28Z729_UI_CYCLE_COUNT_NUM_SIZE		2
#define GAUGE_SET_TERM_PARAM_CMD		0x59  /* Write Termination Parameters */
#define SN28Z729_GAUGE_MIN_CELL_VOLTAGE_OFFSET  11
#define SN28Z729_GAUGE_TERM_VOLT_LEVEL_FIRST	0
#define SN28Z729_GAUGE_TERM_VOLT_LEVEL_SECOND   1
#define SN28Z729_GAUGE_TERM_VOLT_LEVEL_THIRD	2
#define SN28Z729_TERM_VLOT_LEN					17

#define SN28Z729_NEED_TO_SUPPORT_THIRD_TERM_VOLT_FIRM_VER	9
#define SN28Z729_TERM_VLOT_BEFORE_VER_9_LEN	10
#define SN28Z729_EXTEND_DATA_ADDR			0x40
#define SN28Z729_EXTEND_DATA_CHECKSUM_ADDR	0x60
#define SN28Z729_EXTEND_DATA_LEN_ADDR		0x61

#define SN28Z729_REG_DA_CFG					0x4807
#define SN28Z729_SLEEP_MODE_NUM_SIZE		1
#define SN28Z729_SLEEP_MODE_MASK_BIT		BIT(4)

#define SN28Z729_SEAL_STATUS			0x0054
#define SN28Z729_SEAL_BIT				(BIT(0) | BIT(1))
#define SN28Z729_SEAL_VALUE				3
#define SN28Z729_SEALED_SUBCMD			0x0030
#define SN28Z729_UNSEALED_SUBCMD1		0x0414
#define SN28Z729_UNSEALED_SUBCMD2		0x3672
#define SN28Z729_SEAL_POLLING_RETRY_LIMIT	20
#define SN28Z729_SEAL_SHIFT					8
#define SN28Z729_REG_SEAL_SIZE				4

/* sn28z729 standard data commands */
#define SN28Z729_REG_TEMP			0x06
#define SN28Z729_REG_VOLT			0x08
#define SN28Z729_REG_FLAGS			0x0a
#define SN28Z729_REG_NAC			0x14
#define SN28Z729_REG_RM				0x10
#define SN28Z729_REG_FCC			0x12
#define SN28Z729_REG_TI				0x0c
#define SN28Z729_REG_CC				0x2a
#define SN28Z729_REG_SOC			0x2c
#define SN28Z729_REG_SOH			0x2e

#define SN28Z729_CNTL1_DA_CONFIG	0x4807
#define SN28Z729_CLEAR_CAR_C_CMD	0x008A
#define SN28Z729_GET_CAR_C_ADDR		0x00F1

#define SN28Z729_GET_CUV_ADDR		0x0054
#define SN28Z729_GET_CUV_MASK		0x80
#define SN28Z729_GET_CUV_BIT		7
#define SN28Z729_GET_CUV_OFFSET		0x3

#define SN28Z729_REG_CUV_STATE_ADDR			0x15
#define SN28Z729_REG_CUV_STATE_LEN			0x2
#define SN28Z729_CUV_STATE_RETRY_MAX		0x3
#define SN28Z729_CUV_STATE_CHECK_DELAY_MS	600000
#define SN28Z729_CUV_STATE_CUV1				0x1
#define SN28Z729_CUV_STATE_CUV2				0x0

#define GAUGE_GET_DEVICE_ID_CMD                 0x1
#define GAUGE_GET_DEVICE_FIRM_VER_CMD           0x2
#define GAUGE_GET_DEVICE_FIRM_VER_LEN           0x11

#define SN28729_SUBCMD_FORCE_REPORT_FULL_ADDR       0x0014
#define SN28729_SUBCMD_FORCE_REPORT_FULL_CMD        0x0001

#define SN28729_SUBCMD_CYCLIC_DECREASE_VOLTAGE_ADDR 0x430a
#define SN28729_SUBCMD_CYCLIC_DECREASE_VOLTAGE_LEN  0x2

#define ZERO_DEGREE_CELSIUS_IN_TENTH_KELVIN			(-2731)

#define GAUGE_AUTH_MSG_LEN					20
#define GAUGE_SHA256_AUTH_MSG_LEN			32
#define WLS_AUTH_RANDOM_LEN					8
#define WLS_AUTH_ENCODE_LEN					8
#define UFCS_AUTH_MSG_LEN					16
#define SN28729_DEEP_SHIFT                  0x08

#define SN28Z729_AUTHENTICATE_OK		0x56
#define AUTHEN_MESSAGE_MAX_COUNT		30
#define SN28Z729_ECO_UI_CC_OFFSET       25
#define SN28Z729_ECO_UI_CC_WLEN         3
#define SN28Z729_BATT_USED_FLAG_WLEN	2
#define SN28Z729_BATT_USED_FLAG_WADDR	0x4056
#define SN28Z729_BATT_USED_FLAG_OFFSET  28

#define SN28Z729_BATT_WRITE_CHECK_SUM_ADDR	0x60
#define SN28Z729_BATTINFO_DEFAULT_CHECKSUM	0xFF

#define SN28Z729_BATT_UI_SOH_WLEN		2
#define SN28Z729_BATT_UI_SOH_OFFSET     23
#define SN28Z729_GET_PASSEDCHG_ADDR		0x00F1
#define SN28Z729_GET_PASSEDCHG_WLEN		2
#define SN28Z729_GET_PASSEDCHG_OFFSET    0
#define SN28Z729_TERM_VLOT_LEN      	17
#define SN28Z729_TERM_MAX_VLOT_LEN		32
#define SN28Z729_BATT_FIRST_USAGE_DATE_WLEN		3
#define SN28Z729_BATT_FIRST_USAGE_DATE_OFFSET   20

#define SN28Z729_NEED_TO_SUPPORT_THIRD_TERM_VOLT_FIRM_VER   9
#define SN28Z729_TERM_VLOT_BEFORE_VER_9_LEN      			10

#define SN28Z729_BLOCK_SIZE			32
#define SN28Z729_EXTEND_DATA_SIZE		34
#define SN28Z729_REG_TRUE_FCC			0x0073
#define SN28Z729_TRUE_FCC_NUM_SIZE		2
#define SN28Z729_TRUE_FCC_OFFSET		8
#define SN28Z729_FCC_SYNC_CMD			0x0043
#define SN28Z729_FCC_SYNC_THD			200
struct sn28z729_authenticate_data {
	uint8_t result;
	uint8_t message_offset;
	uint8_t message_len;
	uint8_t message[AUTHEN_MESSAGE_MAX_COUNT]; /* 25, larger than 20 bytes */
};

struct wls_chg_auth_result {
	unsigned char random_num[WLS_AUTH_RANDOM_LEN];
	unsigned char encode_num[WLS_AUTH_ENCODE_LEN];
};

typedef struct {
	unsigned char msg[UFCS_AUTH_MSG_LEN];
} oplus_ufcs_auth_result;

struct oplus_gauge_sha256_auth_result {
	unsigned char msg[GAUGE_SHA256_AUTH_MSG_LEN];
	unsigned char rcv_msg[GAUGE_SHA256_AUTH_MSG_LEN];
};

typedef struct {
	int result;
	unsigned char msg[GAUGE_AUTH_MSG_LEN];
	unsigned char rcv_msg[GAUGE_AUTH_MSG_LEN];
} oplus_gauge_auth_result;

typedef struct {
	oplus_gauge_auth_result rst_k0;
	oplus_gauge_auth_result rst_k1;
	struct wls_chg_auth_result wls_auth_data;
	oplus_gauge_auth_result rst_k2;
	oplus_ufcs_auth_result ufcs_k0;
	struct oplus_gauge_sha256_auth_result sha256_rst_k0;
} oplus_gauge_auth_info_type;

enum sn28z729_volt_type {
	SN28Z729_CELL_MAX_VOLT,
	SN28Z729_CELL_MIN_VOLT,
	SN28Z729_CELL_1_VOLT,
	SN28Z729_CELL_2_VOLT,
};

enum sn28z729_dod_parameter_type {
	SN28Z729_CELL_DOD_PASSED_Q,
	SN28Z729_CELL_1_DOD0,
	SN28Z729_CELL_2_DOD0,
};

enum sn28z729_qmax_parameter_type {
	SN28Z729_CELL_QMAX_PASSED_Q,
	SN28Z729_CELL_1_QMAX,
	SN28Z729_CELL_2_QMAX,
};

enum sn28z729_security_mode {
	SN28Z729_MODE_RESERVED,
	SN28Z729_MODE_FULL_ACCESS,
	SN28Z729_MODE_UNSEALED,
	SN28Z729_MODE_SEALED
};

#endif /* __OPLUS_SN28Z729_H__ */



